<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Redirecting...</title>
        <style>
            body {
                background: #121212;
                color: #fff;
                font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100vh;
                margin: 0;
            }
            .spinner {
                border: 4px solid rgba(29, 185, 84, 0.1);
                border-top: 4px solid #1db954;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
                margin: 0 auto 20px;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .message {
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div class="message">
            <div class="spinner"></div>
            <p>Redirecting back to the app...</p>
        </div>
        <script>
            // Get the authorization code and state from the callback URL
            const params = new URLSearchParams(window.location.search);
            const code = params.get('code');
            const state = params.get('state');
            const error = params.get('error');

            // Get the original page from localStorage (set before auth)
            const returnTo = localStorage.getItem('spotify_return_to') || 'index.html';

            // Build the redirect URL with the auth params
            const redirectUrl = new URL(returnTo, window.location.origin);
            if (code) redirectUrl.searchParams.set('code', code);
            if (state) redirectUrl.searchParams.set('state', state);
            if (error) redirectUrl.searchParams.set('error', error);

            // Redirect back to the original page
            window.location.replace(redirectUrl.toString());
        </script>
    </body>
</html>
